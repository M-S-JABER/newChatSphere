# Templates Guide (دليل التمبلت)

هذا المستند يشرح التمبلتات في ChatSphere وكيفية استخدامها من لوحة الإعدادات وداخل المحادثة.

## ما هو التمبلت؟
التمبلت هو قالب رسالة جاهز من WhatsApp Business API يتم إرساله للعميل باستخدام الاسم واللغة.  
التمبلتات تظهر في لوحة **Template** داخل الدردشة، ويمكنك اختيار القالب وإرسال الرسالة مع الباراميترات.

## المتطلبات
- صلاحية مسؤول (Admin) للوصول إلى Settings.
- بيانات الربط مع Meta/WhatsApp:
  - `META_TOKEN`
  - `META_PHONE_NUMBER_ID`
  - (اختياري عند الحاجة) `META_WABA_ID`
- إذا كان التوكن لا يملك صلاحية `whatsapp_business_management` لن تتمكن من جلب القوالب من الحساب.

## إضافة تمبلت يدويًا
من Settings -> **Templates**:
1) اكتب **Template name** (اسم القالب كما هو في حساب واتساب).
2) اكتب **Language** (مثال: `ar` أو `en_US`).
3) **Body parameters**: عدد الباراميترات في نص القالب (مثل `{1}`, `{2}`).  
   - يمكن تركه فارغًا ليتم تحديده تلقائيًا إن كان القالب مستوردًا.
4) **Description** (اختياري) لشرح القالب للموظفين.
5) اضغط **Add template**.

## استيراد تمبلت من حساب واتساب
من Settings -> **Templates** -> قسم **Templates on your WhatsApp account**:
1) اضغط **Refresh**.
2) ستظهر القوالب الموجودة في حساب واتساب وغير المضافة في النظام.
3) اضغط **Add template** بجانب القالب المراد إضافته.

> ملاحظة: الاستيراد يحفظ اسم القالب + اللغة + عدد الباراميترات تلقائيًا.

## تعديل/حذف تمبلت
في قسم **Saved templates**:
- **Edit** لتعديل الاسم/اللغة/الوصف/عدد الباراميترات.
- **Delete** لحذف القالب من النظام (لا يحذف القالب من حساب واتساب نفسه).

## استخدام التمبلت داخل الدردشة
1) افتح أي محادثة.
2) اضغط زر **Template** في أسفل الدردشة.
3) اختر القالب من القائمة.
4) أدخل الباراميترات:
   - قيمة واحدة: `Ahmed`
   - عدة قيم: `["Ahmed","12345"]`
5) اضغط **Send template**.

### ملاحظات الباراميترات
- إذا كان القالب يحتاج عددًا معينًا من الباراميترات، سيظهر تنبيه عند نقصها.
- استخدم صيغة JSON عند أكثر من قيمة.

## مشاكل شائعة
- **لا تظهر قوالب الحساب عند Refresh**:
  - تأكد من أن التوكن صحيح ويملك صلاحية `whatsapp_business_management`.
  - تأكد من `META_PHONE_NUMBER_ID` الصحيح.
  - إذا استمر الخطأ، ضع `META_WABA_ID` في `.env` ثم أعد تشغيل السيرفر.

## مثال سريع
قالب باسم `order_update` ولغته `ar` ويحتاج 2 باراميتر:
- Body parameters: `2`
- عند الإرسال:
  - `["Ahmed","#2031"]`

